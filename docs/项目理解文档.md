# YPrompt 项目理解文档

## 项目概述

YPrompt 是一个基于AI对话引导挖掘用户需求的专业提示词生成系统，基于《Architecting Intelligence: A Definitive Guide to the Art and Science of Elite Prompt Engineering》理论生成高质量的AI提示词。

### 核心功能
- **AI引导式需求收集**: 通过智能对话深入挖掘用户真实需求
- **GPrompt四步生成**: 关键指令提取 → 初始提示词 → 优化建议 → 最终提示词
- **多AI模型支持**: 支持OpenAI、Anthropic、Google Gemini和自定义AI服务商
- **双模式操作**: 自动生成和手动步进两种执行模式
- **格式语言转换**: 支持Markdown/XML格式切换和中英文互译
- **响应式设计**: 完美适配桌面端和移动端设备

## 技术架构

### 技术栈
- **前端框架**: Vue 3 + TypeScript
- **构建工具**: Vite
- **UI框架**: Tailwind CSS
- **状态管理**: Pinia
- **图标库**: Lucide Vue Next
- **Markdown**: Marked

### 项目结构分析

```
src/
├── components/          # Vue组件层
│   ├── ChatInterface.vue       # 对话界面组件
│   ├── PreviewPanel.vue        # 预览面板组件
│   ├── PromptGenerator.vue     # 提示词生成器组件
│   ├── SettingsModal.vue       # 设置弹窗组件
│   └── NotificationContainer.vue  # 通知容器组件
├── stores/              # Pinia状态管理层
│   ├── promptStore.ts           # 提示词状态管理
│   ├── settingsStore.ts        # 设置状态管理
│   └── notificationStore.ts    # 通知状态管理
├── services/            # 业务服务层
│   ├── aiService.ts             # AI服务基础类
│   ├── aiGuideService.ts        # AI引导服务
│   ├── promptGeneratorService.ts # 提示词生成服务
│   └── capabilityDetector.ts   # 模型能力检测
├── config/              # 配置文件层
│   ├── promptGenerator.ts       # 生成器配置
│   ├── prompts.ts              # 提示词配置管理
│   └── prompts/                # 内置提示词规则目录
├── utils/               # 工具函数层
│   ├── aiResponseUtils.ts      # AI响应处理工具
│   └── fileUtils.ts            # 文件处理工具
├── views/               # 页面视图层
│   └── HomeView.vue            # 主页面视图
└── main.ts              # 应用入口
```

## 核心模块详解

### 1. 状态管理 (stores/)

#### promptStore.ts
负责管理整个提示词生成流程的状态：

**核心状态**:
- `currentStep`: 当前对话步骤 (0-5)
- `chatMessages`: 对话消息列表，支持多模态内容
- `promptData`: 生成的提示词数据
- `collectedData`: 收集的用户需求数据
- `isGenerating`: 生成状态标志
- `currentExecutionStep`: 当前执行步骤状态

**关键接口**:
```typescript
interface PromptData {
  requirementReport: string     // 需求总结报告
  thinkingPoints?: string[]     // GPrompt关键指令
  initialPrompt?: string        // GPrompt初始提示词
  advice?: string[]             // GPrompt优化建议
  generatedPrompt: string | {zh: string, en: string}
  optimizedPrompt: {zh: string, en: string}
}
```

#### settingsStore.ts
管理AI提供商配置和应用设置：

**支持的AI提供商**:
- OpenAI (GPT系列)
- Anthropic (Claude系列)
- Google (Gemini系列)
- 自定义提供商

### 2. 服务层 (services/)

#### aiService.ts - AI服务核心
这是整个系统的AI调用核心，支持多种AI提供商的统一接口：

**核心功能**:
- 多模态内容支持 (文本、图片、文档、音频、视频)
- 流式和非流式API调用
- 智能错误处理和用户友好反馈
- Think标签过滤 (`<think></think>`)
- API响应格式标准化

**多模态支持**:
- OpenAI: 主要支持图片
- Anthropic: 主要支持图片  
- Google Gemini: 支持图片、文档、音频、视频等最全面的多模态

#### promptGeneratorService.ts - 提示词生成服务
实现GPrompt四步生成流程：

1. **关键指令提取** (`getSystemPromptThinkingPoints`)
2. **初始提示词生成** (`generateSystemPrompt`) 
3. **优化建议生成** (`getOptimizationAdvice`)
4. **最终提示词优化** (`applyOptimizationAdvice`)

#### aiGuideService.ts - AI引导服务
负责智能对话引导，通过6个步骤收集用户需求：

1. 任务定义 - 明确AI助手的核心任务
2. 使用场景 - 了解使用环境和目标用户
3. 输出格式 - 定义回答的结构和风格
4. 质量要求 - 确定成功标准
5. 工作方式 - 设定思考方式和互动风格
6. 最终确认 - 确认信息完整性

### 3. 配置层 (config/)

#### prompts/ 目录
包含所有内置的提示词生成规则：

- `systemPromptRules.ts`: 系统提示词工程规则
- `thinkingPointsExtraction.ts`: 关键指令提取规则
- `optimizationAdvice.ts`: 优化建议生成规则
- `userGuidedRules.ts`: 用户引导规则

### 4. 组件层 (components/)

#### ChatInterface.vue - 对话界面
- 支持多模态消息 (文本+附件)
- 消息编辑和删除功能
- 流式响应显示
- 移动端适配

#### PreviewPanel.vue - 预览面板
- 实时显示生成的提示词
- 支持中英文切换
- 格式化显示
- 复制功能

## 工作流程

### 1. AI引导式需求收集
```
用户输入需求 → AI智能提问 → 收集结构化数据 → 生成需求报告
```

### 2. GPrompt四步生成
```
需求报告 → 关键指令提取 → 初始提示词 → 优化建议 → 最终提示词
```

### 3. 双模式支持
- **自动模式**: 一键完成整个生成流程
- **手动模式**: 用户可在每个步骤进行干预和调整

## 特色功能

### 1. 多模态支持
系统支持用户上传图片、文档等附件，AI可以基于这些多模态内容生成更精准的提示词。

### 2. 流式响应
支持实时流式显示AI响应，提升用户体验。

### 3. 智能错误处理
针对不同AI提供商的错误进行智能解析，提供用户友好的错误提示。

### 4. 移动端优化
采用折叠式界面设计，完美适配移动设备。

### 5. 配置化提示词规则
所有提示词生成规则都是可配置的，便于维护和优化。

## 部署方式

项目支持多种部署方式：

1. **Vercel一键部署** (推荐)
2. **本地开发部署**
3. **Docker容器化部署**

### 构建命令
```bash
npm install          # 安装依赖
npm run build        # 构建生产版本
npm run dev          # 本地开发
```

## 开发要点

### 1. 新增AI提供商
在 `settingsStore.ts` 中添加新的提供商配置，在 `aiService.ts` 中实现对应的API调用逻辑。

### 2. 自定义提示词规则
修改 `config/prompts/` 目录下的相关文件。

### 3. 新增组件
遵循现有的组件结构和命名规范。

### 4. 状态管理
使用Pinia进行状态管理，保持状态的响应式和类型安全。

## 项目优势

1. **理论基础扎实**: 基于权威提示词工程理论
2. **工程化程度高**: 模块化、可配置、可扩展
3. **用户体验佳**: 响应式设计、流式响应、智能引导
4. **技术栈现代**: Vue 3 + TypeScript + Vite
5. **多平台支持**: 桌面端和移动端完美适配

这个项目是一个非常优秀的提示词工程工具，代码结构清晰，功能完整，具有很强的实用价值和扩展性。